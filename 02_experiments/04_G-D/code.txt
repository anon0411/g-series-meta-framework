from qiskit import QuantumCircuit, QuantumRegister, ClassicalRegister
from qiskit_aer import Aer
from collections import Counter
import matplotlib.pyplot as plt

# ì‹œë®¬ë ˆì´í„° ì„¤ì •
simulator = Aer.get_backend('aer_simulator')

# ë°˜ë³µ íšŸìˆ˜
n_trials = 10
shots = 1024

# ê²°ê³¼ ì €ì¥
pairs = []

# íšŒë¡œ ì‹¤í–‰ ë°˜ë³µ
for i in range(n_trials):
    # 1ì°¨ íšŒë¡œ (êµ¬ì¡° ìƒì„±)
    qr1 = QuantumRegister(2)
    cr1 = ClassicalRegister(2)
    circ1 = QuantumCircuit(qr1, cr1)
    circ1.h(0)
    circ1.cx(0, 1)
    circ1.measure([0, 1], [0, 1])

    result1 = simulator.run(circ1, shots=shots).result()
    counts1 = result1.get_counts()
    result1_major = max(counts1, key=counts1.get)

    # 2ì°¨ íšŒë¡œ (ìê¸° ë°˜ë³µ ì—¬ë¶€ ê´€ì¸¡)
    qr2 = QuantumRegister(2)
    cr2 = ClassicalRegister(2)
    circ2 = QuantumCircuit(qr2, cr2)
    circ2.h(0)
    circ2.cx(0, 1)
    circ2.measure([0, 1], [0, 1])

    result2 = simulator.run(circ2, shots=shots).result()
    counts2 = result2.get_counts()
    result2_major = max(counts2, key=counts2.get)

    # ê²°ê³¼ ìŒ ì €ì¥
    pairs.append((result1_major, result2_major))
    print(f"Trial {i+1}: {result1_major} â†’ {result2_major}")

# í†µê³„ ë¶„ì„
match_count = sum([1 for a, b in pairs if a == b])
print(f"\nğŸ§® ë™ì¼í•œ ê²°ê³¼ ë°˜ë³µëœ íšŸìˆ˜: {match_count} / {n_trials}")

# ì‹œê°í™”
labels = [f"{a}â†’{b}" for a, b in pairs]
counts = Counter(labels)

plt.figure(figsize=(10, 4))
plt.bar(counts.keys(), counts.values())
plt.title("G-D êµ¬ì¡° ìê¸° ë°˜ë³µ ê²°ê³¼ ìŒ")
plt.xlabel("1ì°¨ ê²°ê³¼ â†’ 2ì°¨ ê²°ê³¼")
plt.ylabel("ë¹ˆë„ (íšŸìˆ˜)")
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()



#result :
#Trial 1: 11 â†’ 00
#Trial 2: 00 â†’ 11
#Trial 3: 11 â†’ 00
#Trial 4: 00 â†’ 11
#Trial 5: 11 â†’ 11
#Trial 6: 00 â†’ 00
#Trial 7: 00 â†’ 00
#Trial 8: 11 â†’ 00
#Trial 9: 11 â†’ 00
#Trial 10: 11 â†’ 00

#ğŸ§® ë™ì¼í•œ ê²°ê³¼ ë°˜ë³µëœ íšŸìˆ˜: 3 / 10